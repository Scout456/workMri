$(function(){

	// toggle sections
	$('.container').on('touchstart click', '.toggle-btn', function(){
			tmp = $(this).attr('id').slice(4);
			if ($(this).hasClass('edit')) {
				expandSection(tmp);
			} else {
				contractSection(tmp);
			};
			return false;
	})
	
	
	// contract current section and open new section
	contractSection = function(id){
			// if browser doesn't support css transitions, use animate
			if (!Modernizr.csstransitions) {
					$("#section"+id).stop(true, true).animate({
						height: 90
					}, 400, 'easeOutExpo');
			}
			$('#section'+id).removeClass('expanded');
			$('#section'+id).addClass('condensed');
			$('#section'+id+' .question-wrap').removeClass('open');
			if ($(window).width()<=768) {
					$('#section'+id).css({'height': '50px'});
					if (id==3 && section3.hasClass('triple')) {
						 section3.css({'height': '110px'});
					};
			}
			setTimeout(function(){
					$('#section'+id+' .result-wrap').addClass('open');
			},200);
			$('.toggle-btn#edit'+id).addClass('edit');
	}



	// expand contracted section
	expandSection = function(id){
			// if browser doesn't support css transitions, use animate
			if (!Modernizr.csstransitions) {
					$('#section'+id).stop(true, true).animate({
							height: 325
					}, 400, 'easeOutExpo', function(){
							$('#section'+id).removeClass('condensed');
							$('#section'+id).addClass('expanded');
					});
			} else {
					$('#section'+id).removeClass('condensed');
					$('#section'+id).addClass('expanded');
			};
			$('#section'+id+' .result-wrap').removeClass('open');
			setTimeout(function(){
					$('#section'+id+' .question-wrap').addClass('open');
			},200);
			if ($(window).width()<=768) {
					$('#section'+id).css({'height': ($('#section'+id+' .container').height()+80)+'px'});
			}
			$('.toggle-btn#edit'+id).removeClass('edit');
	}
	
	
	// get current input field id value for use in enter-key trigger
	$('input[type="text"]').focus(function() {
			btnID = $(this).attr('id'); // set global
	});
	
	// trigger button click with enter-key
	$(document).on('keydown', function(e) {
		  if (e.keyCode == 13) {
		    	e.preventDefault();
		    	// checkProMriFrom:country_input --> country
		    	// checkProMriFrom:inLead2_input --> inLead
		    	var inputId = btnID.substring(btnID.indexOf(':') + 1, btnID.indexOf('_'));
		    	inputId = inputId.replace('1', '');
		    	inputId = inputId.replace('2', '');
		    	inputId = inputId.replace('3', '');
		    	$('#checkProMriFrom\\:enter-'+inputId).trigger('click');
		    	$('input:focus').blur(); // remove focus of all input fields
		    	return false;
		  }
	});


	// edit fields with click on result
	$('.result').on('click', function(){
			$(this).closest('.container').find('.edit').trigger('click');
	});



	// toggle fixed conditions
	$('#fc-toggle').on('click', function(){
		$('#fixed-conditions').toggleClass('open');
		$(this).toggleClass('open');
	});

	// if browser doesn't support placeholder, workaround
	if (!Modernizr.input.placeholder) {
			$('[placeholder]').focus(function() {
				  var input = $(this);
				  if (input.val() == input.attr('placeholder')) {
				    input.val('');
				    input.removeClass('placeholder');
				  }
			}).blur(function() {
				  var input = $(this);
				  if (input.val() == '' || input.val() == input.attr('placeholder')) {
				    	input.addClass('placeholder');
				    	input.val(input.attr('placeholder'));
				  }
			}).blur().parents('form').submit(function() {
				  $(this).find('[placeholder]').each(function() {
					    var input = $(this);
					    if (input.val() == input.attr('placeholder')) {
					      input.val('');
					    }
				  });
			});
	};

	// initialize popups with magnific plugin
	$('.open-popup-link').magnificPopup({
			type:'inline',
			midClick: true,
			removalDelay: 300,
			mainClass: 'mfp-fade'
	});
	
	// print function
	$(document).on('touchstart click', '#print-btn', function(){
		$('#print-options').removeClass('open');
		window.print();
	});
	
	// contract current section and open new section
	closeProgressDialog = function(){
		function hideDialog(){
			PF('progressDialog').hide();
			$('#progressDialog').spin(false);
		   };
		window.setTimeout(hideDialog, 250); // 250ms
		
	};
	
	// New March 2015
	// language dropdown
	function DropDown(el, lang) {
		this.dd = el;
		this.placeholder = this.dd.children('span');
		langSpan = this.placeholder.children('span.language');
		codeSpan = this.placeholder.children('span.country-code');
		this.opts = this.dd.find('ul.dropdown > li');
		this.val = '';
		this.index = -1;
		this.initEvents();
		if (lang.indexOf('it') != -1) {
			langSpan.html('Italiano');
			codeSpan.html('(IT)') 
		} else if (lang.indexOf('de') != -1) {
			langSpan.html('Deutsch');
			codeSpan.html('(DE)') 
		} else if (lang.indexOf('es') != -1) {
			langSpan.html('Español');
			codeSpan.html('(ES)') 
		} else	if (lang.indexOf('fr') != -1) {
			langSpan.html('Français');
			codeSpan.html('(FR)') 
		} else	if (lang.indexOf('pt') != -1) {
			langSpan.html('Português');
			codeSpan.html('(PT)') 
		} else {
			langSpan.html('English');
			codeSpan.html('(EN)') 
		}
			
	}
	DropDown.prototype = {
			initEvents : function() {
				var obj = this;
				obj.dd.on('click', function(event){
					$(this).toggleClass('active');
					$('.section').toggleClass('off');
				});
			},
			getValue : function() {
				return this.val;
			},
			getIndex : function() {
				return this.index;
			}
		}

	$(function() {
		lang = $('#language-dropdown').attr('lang');
		var dd = new DropDown( $('#language-dropdown'), lang);
		
	});		
	$(document).on('click touchstart', function(event){
		if (!$(event.target).closest('#language-dropdown').length && $('#language-dropdown').hasClass('active')) {
			$('#language-dropdown').removeClass('active');
			$('.section').removeClass('off');
		};
	})
	
	
});

//extend easings
jQuery.extend( jQuery.easing,
{
	def: 'easeInOutQuart',
	easeInOutQuart: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
		return -c/2 * ((t-=2)*t*t*t - 2) + b;
	}, easeOutExpo: function (x, t, b, c, d) {
		return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
	}
});